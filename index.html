<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Todo</title>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <main>
      <section
        class="m-4 flex max-w-lg flex-col gap-2 rounded border-2 border-black p-4"
        x-data="{
            list: JSON.parse(localStorage.getItem('todo')) || [],

            inputValue: '',
            search: '',
            category: '',
            showOpen: true,
            showClosed: true,
            showBinned: false,
            id: 0,

            remove(target) {
              if (target.binned) {
                this.list = this.list.filter(item => item !== target);
              } else {
                target.binned = true;
              }
            },

            get filteredList() {
              return this.list.filter(item => item.label.startsWith(this.search)).sort((a, b) => {  
                if (a.binned && !b.binned) {
                  return 1;
                } else if (!a.binned && b.binned) {
                  return -1;
                } else {
                  return 0;
                }
              });
            }
          }"
        x-init="$watch('list', (val) => localStorage.setItem('todo', JSON.stringify(list)))"
      >
        <h1 class="mx-auto">Todo</h1>
        <form
          @submit.prevent="list.push({ id: id++, label: $event.target.label.value, completed: false, category, binned: false }); inputValue = ''"
        >
          <div class="flex gap-1">
            <label class="flex-grow">
              <input
                name="label"
                type="text"
                required
                placeholder="What do you want to do?"
                class="focus:border-1 h-8 w-full flex-grow rounded border border-blue-500 px-2 focus:border-blue-100"
                x-model="inputValue"
              />
            </label>
            <div class="flex gap-0.5">
              <button
                type="submit"
                class="h-8 w-8 rounded bg-rose-800"
                @click="category = 'bg-rose-800'"
              ></button>
              <button
                type="submit"
                class="h-8 w-8 rounded bg-cyan-700"
                @click="category = 'bg-cyan-700'"
              ></button>
              <button
                type="submit"
                class="h-8 w-8 rounded bg-orange-600"
                @click="category = 'bg-orange-600'"
              ></button>
              <button
                type="submit"
                class="h-8 w-8 rounded bg-indigo-700"
                @click="category = 'bg-indigo-700'"
              ></button>
            </div>
          </div>
        </form>
        <div class="flex gap-2 mt-4" x-show="list.length > 0">
          <label class="flex-grow">
            <input
              class="mr-1 w-full flex-grow rounded border px-1"
              placeholder="Search"
              x-model="search"
            />
          </label>
          <div class="flex gap-1">
            <label>
              Open
              <input type="checkbox" x-model="showOpen" />
            </label>
            <label>
              Closed
              <input type="checkbox" x-model="showClosed" />
            </label>
            <label>
              Binned
              <input type="checkbox" x-model="showBinned" />
            </label>
          </div>
        </div>
        <template x-for="item in filteredList" :key="item.id">
          <ul
            class="flex gap-1 mt-1"
            x-show="showOpen && (!item.completed || showClosed) && (!item.binned || showBinned)"
          >
            <div
              class="items flex w-8 cursor-pointer justify-center rounded"
              :class="item.category"
              @click="item.completed = !item.completed"
            ></div>
            <div class="flex-grow px-2">
              <li
                x-text="item.label"
                class="cursor-pointer"
                :class="item.completed ? 'line-through' : ''"
                :class="item.binned ? 'filter brightness-50' : ''"
                @click="item.completed = !item.completed"
              ></li>
            </div>
            <button
              type="button"
              class="h-8 w-16 rounded border-2 border-red-600 text-red-600"
              x-text="item.binned ? 'Delete' : 'Bin'"
              @click="remove(item)"
            />
            <button
              type="button"
              class="h-8 w-16 rounded border-2 border-green-900 text-green-900"
              x-show="item.binned"
              x-text="'Restore'"
              @click="item.binned = false"
            />
          </ul>
        </template>
      </section>
    </main>
  </body>
</html>
